<!DOCTYPE html>

<html class="light" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>DocSense: Document Processing Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.min.js"></script>
    <script>
      // Configure PDF.js worker
      if (typeof pdfjsLib !== "undefined") {
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
      }
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
      rel="stylesheet"
    />
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
        font-size: 20px; /* Default size */
      }
      /* Hide native dropdown arrow completely for all browsers */
      select {
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        -o-appearance: none !important;
        background-image: none !important;
        background-repeat: no-repeat !important;
      }
      /* For IE and Edge */
      select::-ms-expand {
        display: none !important;
      }
      /* Specifically target the action select dropdown */
      #actionSelect {
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
        -o-appearance: none !important;
        background-image: none !important;
      }
      #actionSelect::-ms-expand {
        display: none !important;
      }
      /* Ensure no background images for dropdown arrow */
      select:not([multiple]) {
        background-image: none !important;
        padding-right: 2.5rem !important;
      }
      /* Remove any pseudo-elements that might show arrows */
      select::before,
      select::after {
        display: none !important;
      }
    </style>
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#137fec",
              "background-light": "#f6f7f8",
              "background-dark": "#101922",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.25rem",
              lg: "0.5rem",
              xl: "0.75rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="font-display bg-background-light dark:bg-background-dark text-gray-800 dark:text-gray-200"
  >
    <div
      class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden"
    >
      <!-- TopNavBar -->
      <header
        class="flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200 dark:border-gray-700 px-6 md:px-10 py-3 bg-white dark:bg-background-dark sticky top-0 z-10"
      >
        <div class="flex items-center gap-3 text-gray-900 dark:text-white">
          <div class="size-6 text-primary">
            <svg
              fill="none"
              viewbox="0 0 48 48"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M13.8261 17.4264C16.7203 18.1174 20.2244 18.5217 24 18.5217C27.7756 18.5217 31.2797 18.1174 34.1739 17.4264C36.9144 16.7722 39.9967 15.2331 41.3563 14.1648L24.8486 40.6391C24.4571 41.267 23.5429 41.267 23.1514 40.6391L6.64374 14.1648C8.00331 15.2331 11.0856 16.7722 13.8261 17.4264Z"
                fill="currentColor"
              ></path>
              <path
                clip-rule="evenodd"
                d="M39.998 12.236C39.9944 12.2537 39.9875 12.2845 39.9748 12.3294C39.9436 12.4399 39.8949 12.5741 39.8346 12.7175C39.8168 12.7597 39.7989 12.8007 39.7813 12.8398C38.5103 13.7113 35.9788 14.9393 33.7095 15.4811C30.9875 16.131 27.6413 16.5217 24 16.5217C20.3587 16.5217 17.0125 16.131 14.2905 15.4811C12.0012 14.9346 9.44505 13.6897 8.18538 12.8168C8.17384 12.7925 8.16216 12.767 8.15052 12.7408C8.09919 12.6249 8.05721 12.5114 8.02977 12.411C8.00356 12.3152 8.00039 12.2667 8.00004 12.2612C8.00004 12.261 8 12.2607 8.00004 12.2612C8.00004 12.2359 8.0104 11.9233 8.68485 11.3686C9.34546 10.8254 10.4222 10.2469 11.9291 9.72276C14.9242 8.68098 19.1919 8 24 8C28.8081 8 33.0758 8.68098 36.0709 9.72276C37.5778 10.2469 38.6545 10.8254 39.3151 11.3686C39.9006 11.8501 39.9857 12.1489 39.998 12.236ZM4.95178 15.2312L21.4543 41.6973C22.6288 43.5809 25.3712 43.5809 26.5457 41.6973L43.0534 15.223C43.0709 15.1948 43.0878 15.1662 43.104 15.1371L41.3563 14.1648C43.104 15.1371 43.1038 15.1374 43.104 15.1371L43.1051 15.135L43.1065 15.1325L43.1101 15.1261L43.1199 15.1082C43.1276 15.094 43.1377 15.0754 43.1497 15.0527C43.1738 15.0075 43.2062 14.9455 43.244 14.8701C43.319 14.7208 43.4196 14.511 43.5217 14.2683C43.6901 13.8679 44 13.0689 44 12.2609C44 10.5573 43.003 9.22254 41.8558 8.2791C40.6947 7.32427 39.1354 6.55361 37.385 5.94477C33.8654 4.72057 29.133 4 24 4C18.867 4 14.1346 4.72057 10.615 5.94478C8.86463 6.55361 7.30529 7.32428 6.14419 8.27911C4.99695 9.22255 3.99999 10.5573 3.99999 12.2609C3.99999 13.1275 4.29264 13.9078 4.49321 14.3607C4.60375 14.6102 4.71348 14.8196 4.79687 14.9689C4.83898 15.0444 4.87547 15.1065 4.9035 15.1529C4.91754 15.1762 4.92954 15.1957 4.93916 15.2111L4.94662 15.223L4.95178 15.2312ZM35.9868 18.996L24 38.22L12.0131 18.996C12.4661 19.1391 12.9179 19.2658 13.3617 19.3718C16.4281 20.1039 20.0901 20.5217 24 20.5217C27.9099 20.5217 31.5719 20.1039 34.6383 19.3718C35.082 19.2658 35.5339 19.1391 35.9868 18.996Z"
                fill="currentColor"
                fill-rule="evenodd"
              ></path>
            </svg>
          </div>
          <h2
            class="text-gray-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]"
          >
            DocSense
          </h2>
        </div>
        <button
          id="darkModeToggle"
          class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 w-10 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200"
        >
          <span class="material-symbols-outlined">dark_mode</span>
        </button>
      </header>
      <main class="flex-grow p-4 md:p-10">
        <div class="max-w-screen-2xl mx-auto">
          <!-- PageHeading -->
          <div class="flex flex-wrap justify-between gap-3 p-4">
            <div class="flex min-w-72 flex-col gap-2">
              <p
                class="text-gray-900 dark:text-white text-3xl md:text-4xl font-black leading-tight tracking-[-0.033em]"
              >
                AI-Powered Document Processing
              </p>
              <p
                class="text-gray-500 dark:text-gray-400 text-base font-normal leading-normal"
              >
                Upload your document, select an action, and get instant results.
              </p>
            </div>
          </div>
          <div class="grid grid-cols-1 xl:grid-cols-12 gap-6 mt-6">
            <!-- Left Column: Controls -->
            <div class="xl:col-span-3 flex flex-col gap-6">
              <div
                class="bg-white dark:bg-background-dark rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 space-y-6"
              >
                <!-- SectionHeader 1 -->
                <h2
                  class="text-gray-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] -mx-2"
                >
                  1. Upload Your Document
                </h2>
                <!-- EmptyState for Upload -->
                <div class="flex flex-col">
                  <div
                    id="dropZone"
                    class="flex flex-col items-center gap-4 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-600 px-6 py-10 text-center"
                  >
                    <span
                      class="material-symbols-outlined text-gray-400 dark:text-gray-500 !text-4xl"
                      >upload_file</span
                    >
                    <div class="flex flex-col items-center gap-1">
                      <p
                        class="text-gray-800 dark:text-gray-200 text-base font-semibold leading-tight"
                      >
                        Drag &amp; drop your file here
                      </p>
                      <p
                        class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal"
                      >
                        PDF, DOCX, or TXT
                      </p>
                    </div>
                    <button
                      id="browseBtn"
                      class="flex w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-sm font-bold leading-normal tracking-[0.015em] hover:bg-gray-200 dark:hover:bg-gray-700"
                    >
                      <span class="truncate">Browse Files</span>
                    </button>
                    <input
                      type="file"
                      id="fileInput"
                      accept=".pdf,.docx,.doc,.txt"
                      class="hidden"
                    />
                  </div>
                </div>
                <!-- Uploaded File -->
                <div
                  id="uploadedFileSection"
                  class="flex flex-col gap-3 hidden"
                >
                  <h3
                    class="text-sm font-medium text-gray-500 dark:text-gray-400"
                  >
                    UPLOADED FILE
                  </h3>
                  <div
                    class="flex items-center gap-4 bg-white dark:bg-background-dark px-4 py-3 border border-gray-200 dark:border-gray-700 rounded-lg"
                  >
                    <div
                      class="text-primary flex items-center justify-center rounded-lg bg-primary/20 shrink-0 size-10"
                    >
                      <span class="material-symbols-outlined !text-2xl"
                        >description</span
                      >
                    </div>
                    <div class="flex-1 min-w-0">
                      <p
                        id="fileName"
                        class="text-gray-800 dark:text-gray-200 text-sm font-medium leading-normal truncate"
                      ></p>
                      <p
                        id="fileSize"
                        class="text-gray-500 dark:text-gray-400 text-xs"
                      ></p>
                    </div>
                    <button
                      id="removeFileBtn"
                      class="shrink-0 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300"
                    >
                      <span
                        class="material-symbols-outlined flex size-7 items-center justify-center !text-2xl"
                        >close</span
                      >
                    </button>
                  </div>
                </div>
                <!-- SectionHeader 2 -->
                <h2
                  class="text-gray-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] -mx-2 pt-2"
                >
                  2. Select an Action
                </h2>
                <!-- Dropdown Menu -->
                <div class="relative">
                  <select
                    id="actionSelect"
                    class="w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg h-12 px-4 pr-10 text-sm text-gray-800 dark:text-gray-200 focus:ring-2 focus:ring-primary focus:border-primary"
                  >
                    <option value="summarize">Summarizer</option>
                    <option value="extract">Information Extractor</option>
                    <option value="classify">Document Classifier</option>
                    <option value="convert-json">JSON Converter</option>
                    <option value="compare">Document Comparison</option>
                  </select>
                  <span
                    class="material-symbols-outlined absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 dark:text-gray-500"
                    >expand_more</span
                  >
                </div>
                <!-- Second file input for comparison -->
                <div id="secondFileSection" class="hidden">
                  <h3
                    class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2"
                  >
                    SECOND FILE (for comparison)
                  </h3>
                  <input
                    type="file"
                    id="fileInput2"
                    accept=".pdf,.docx,.doc,.txt"
                    class="w-full text-sm text-gray-800 dark:text-gray-200 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:bg-primary/90"
                  />
                </div>
                <!-- CTA Button -->
                <button
                  id="processBtn"
                  class="flex w-full cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-4 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-primary/90 disabled:bg-gray-300 disabled:dark:bg-gray-700 disabled:cursor-not-allowed"
                >
                  <span class="material-symbols-outlined">bolt</span>
                  <span class="truncate">Process Document</span>
                </button>
                <button
                  id="clearBtn"
                  class="flex w-full cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-4 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-200 text-base font-bold leading-normal tracking-[0.015em] hover:bg-gray-200 dark:hover:bg-gray-700"
                >
                  <span class="material-symbols-outlined">delete</span>
                  <span class="truncate">Clear</span>
                </button>
              </div>
            </div>
            <!-- Center Column: Document Preview -->
            <div class="xl:col-span-5">
              <div
                class="bg-white dark:bg-background-dark rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 h-full min-h-[600px] flex flex-col"
              >
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                  <h3
                    class="text-gray-900 dark:text-white text-base font-semibold"
                  >
                    Document Preview
                  </h3>
                </div>
                <div class="flex-grow p-6 overflow-auto">
                  <div
                    id="previewEmpty"
                    class="flex items-center justify-center h-full"
                  >
                    <div
                      class="text-center text-gray-500 dark:text-gray-400 space-y-3"
                    >
                      <span
                        class="material-symbols-outlined !text-5xl text-gray-400 dark:text-gray-500"
                        >visibility</span
                      >
                      <p class="font-medium">
                        Your document preview will appear here.
                      </p>
                      <p class="text-sm">Upload a document to get started.</p>
                    </div>
                  </div>
                  <div id="previewContent" class="hidden">
                    <!-- PDF Viewer Container -->
                    <div id="pdfViewer" class="hidden">
                      <div
                        id="pdfControls"
                        class="mb-4 flex items-center justify-between gap-2"
                      >
                        <button
                          id="pdfPrev"
                          class="px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700"
                        >
                          Previous
                        </button>
                        <span
                          id="pdfPageInfo"
                          class="text-sm text-gray-600 dark:text-gray-400"
                        >
                          Page <span id="pdfCurrentPage">1</span> of
                          <span id="pdfTotalPages">0</span>
                        </span>
                        <button
                          id="pdfNext"
                          class="px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700"
                        >
                          Next
                        </button>
                      </div>
                      <div
                        id="pdfCanvas"
                        class="flex justify-center border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900 p-4"
                      >
                        <canvas
                          id="pdfCanvasElement"
                          class="max-w-full shadow-lg"
                        ></canvas>
                      </div>
                    </div>
                    <!-- Text/Other Preview -->
                    <div id="textPreview">
                      <pre
                        id="previewText"
                        class="text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap font-mono"
                      ></pre>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Right Column: Results -->
            <div class="xl:col-span-4">
              <div
                class="bg-white dark:bg-background-dark rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 h-full min-h-[600px] flex flex-col"
              >
                <div
                  class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"
                >
                  <h3
                    class="text-gray-900 dark:text-white text-base font-semibold"
                  >
                    AI Processed Results
                  </h3>
                  <div class="flex items-center gap-2">
                    <button
                      id="copyResultBtn"
                      class="flex items-center justify-center size-8 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"
                      title="Copy to clipboard"
                    >
                      <span class="material-symbols-outlined"
                        >content_copy</span
                      >
                    </button>
                    <button
                      id="downloadResultBtn"
                      class="flex items-center justify-center size-8 rounded-lg text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800"
                      title="Download as Word document"
                    >
                      <span class="material-symbols-outlined">download</span>
                    </button>
                  </div>
                </div>
                <!-- Loading State -->
                <div
                  id="loadingState"
                  class="flex-grow p-6 flex items-center justify-center hidden"
                >
                  <div
                    class="text-center text-gray-500 dark:text-gray-400 space-y-4"
                  >
                    <svg
                      class="animate-spin h-10 w-10 text-primary mx-auto"
                      fill="none"
                      viewbox="0 0 24 24"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                      ></circle>
                      <path
                        class="opacity-75"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                        fill="currentColor"
                      ></path>
                    </svg>
                    <p class="font-medium">Processing your document...</p>
                  </div>
                </div>
                <!-- Result State -->
                <div
                  id="resultState"
                  class="flex-grow p-6 overflow-auto hidden"
                >
                  <div id="resultContent"></div>
                </div>
                <!-- Initial State -->
                <div
                  id="initialState"
                  class="flex-grow p-6 flex items-center justify-center"
                >
                  <div
                    class="text-center text-gray-500 dark:text-gray-400 space-y-3"
                  >
                    <span
                      class="material-symbols-outlined !text-5xl text-gray-400 dark:text-gray-500"
                      >auto_awesome</span
                    >
                    <p class="font-medium">
                      Your results will be displayed here.
                    </p>
                    <p class="text-sm">Process a document to see the output.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script>
      const API_BASE_URL = "http://localhost:8000";

      // State
      let currentFile = null;
      let currentFile2 = null;

      // DOM Elements
      const fileInput = document.getElementById("fileInput");
      const fileInput2 = document.getElementById("fileInput2");
      const browseBtn = document.getElementById("browseBtn");
      const dropZone = document.getElementById("dropZone");
      const uploadedFileSection = document.getElementById(
        "uploadedFileSection"
      );
      const fileName = document.getElementById("fileName");
      const fileSize = document.getElementById("fileSize");
      const removeFileBtn = document.getElementById("removeFileBtn");
      const actionSelect = document.getElementById("actionSelect");

      // Ensure native dropdown arrow is hidden
      if (actionSelect) {
        actionSelect.style.appearance = "none";
        actionSelect.style.webkitAppearance = "none";
        actionSelect.style.mozAppearance = "none";
        actionSelect.style.backgroundImage = "none";

        // Handle dark mode background
        const updateSelectBackground = () => {
          if (document.documentElement.classList.contains("dark")) {
            actionSelect.style.backgroundColor = "#1f2937"; // gray-800
          } else {
            actionSelect.style.backgroundColor = "white";
          }
        };
        updateSelectBackground();

        // Update on dark mode toggle
        const observer = new MutationObserver(updateSelectBackground);
        observer.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ["class"],
        });
      }
      const processBtn = document.getElementById("processBtn");
      const clearBtn = document.getElementById("clearBtn");
      const secondFileSection = document.getElementById("secondFileSection");
      const previewEmpty = document.getElementById("previewEmpty");
      const previewContent = document.getElementById("previewContent");
      const previewText = document.getElementById("previewText");
      const pdfViewer = document.getElementById("pdfViewer");
      const textPreview = document.getElementById("textPreview");
      const pdfCanvas = document.getElementById("pdfCanvasElement");
      const pdfPrevBtn = document.getElementById("pdfPrev");
      const pdfNextBtn = document.getElementById("pdfNext");
      const pdfCurrentPageSpan = document.getElementById("pdfCurrentPage");
      const pdfTotalPagesSpan = document.getElementById("pdfTotalPages");
      const loadingState = document.getElementById("loadingState");
      const resultState = document.getElementById("resultState");
      const initialState = document.getElementById("initialState");
      const resultContent = document.getElementById("resultContent");
      const darkModeToggle = document.getElementById("darkModeToggle");
      const copyResultBtn = document.getElementById("copyResultBtn");
      const downloadResultBtn = document.getElementById("downloadResultBtn");

      // PDF state
      let pdfDoc = null;
      let currentPageNum = 1;
      let currentResultData = null;
      let currentResultAction = null;

      // Dark mode toggle
      darkModeToggle.addEventListener("click", () => {
        document.documentElement.classList.toggle("dark");
        localStorage.setItem(
          "darkMode",
          document.documentElement.classList.contains("dark")
        );
      });

      // Load dark mode preference
      if (localStorage.getItem("darkMode") === "true") {
        document.documentElement.classList.add("dark");
      }

      // File upload handlers
      browseBtn.addEventListener("click", () => fileInput.click());
      fileInput.addEventListener("change", handleFileSelect);
      fileInput2.addEventListener("change", (e) => {
        currentFile2 = e.target.files[0];
      });

      // Drag and drop
      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("border-primary", "bg-primary/5");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("border-primary", "bg-primary/5");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("border-primary", "bg-primary/5");
        if (e.dataTransfer.files.length > 0) {
          fileInput.files = e.dataTransfer.files;
          handleFileSelect({ target: { files: e.dataTransfer.files } });
        }
      });

      function handleFileSelect(e) {
        const file = e.target.files[0];
        if (file) {
          currentFile = file;
          fileName.textContent = file.name;
          fileSize.textContent = formatFileSize(file.size);
          uploadedFileSection.classList.remove("hidden");
          dropZone.classList.add("hidden");

          // Preview file content
          previewFile(file);
        }
      }

      // PDF rendering functions
      async function renderPDFPage(pageNum) {
        if (!pdfDoc) return;

        const page = await pdfDoc.getPage(pageNum);
        const viewport = page.getViewport({ scale: 1.5 });

        pdfCanvas.height = viewport.height;
        pdfCanvas.width = viewport.width;

        const renderContext = {
          canvasContext: pdfCanvas.getContext("2d"),
          viewport: viewport,
        };

        await page.render(renderContext).promise;
        pdfCurrentPageSpan.textContent = pageNum;
      }

      async function loadPDF(file) {
        try {
          // Check if PDF.js is loaded
          if (typeof pdfjsLib === "undefined") {
            throw new Error("PDF.js library not loaded");
          }

          const arrayBuffer = await file.arrayBuffer();
          pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
          currentPageNum = 1;
          pdfTotalPagesSpan.textContent = pdfDoc.numPages;
          await renderPDFPage(1);

          pdfViewer.classList.remove("hidden");
          textPreview.classList.add("hidden");
          previewEmpty.classList.add("hidden");
          previewContent.classList.remove("hidden");
        } catch (error) {
          console.error("Error loading PDF:", error);
          previewText.textContent = `Error loading PDF: ${error.message}. Showing text preview instead.`;
          pdfViewer.classList.add("hidden");
          textPreview.classList.remove("hidden");
          previewEmpty.classList.add("hidden");
          previewContent.classList.remove("hidden");

          // Fallback to text preview
          try {
            const formData = new FormData();
            formData.append("file", file);
            const response = await fetch(`${API_BASE_URL}/api/preview`, {
              method: "POST",
              body: formData,
            });
            if (response.ok) {
              const data = await response.json();
              previewText.textContent = data.preview || "Preview not available";
            }
          } catch (e) {
            console.error("Fallback preview failed:", e);
          }
        }
      }

      pdfPrevBtn.addEventListener("click", async () => {
        if (pdfDoc && currentPageNum > 1) {
          currentPageNum--;
          await renderPDFPage(currentPageNum);
        }
      });

      pdfNextBtn.addEventListener("click", async () => {
        if (pdfDoc && currentPageNum < pdfDoc.numPages) {
          currentPageNum++;
          await renderPDFPage(currentPageNum);
        }
      });

      async function previewFile(file) {
        const fileExtension = file.name.split(".").pop().toLowerCase();

        // Handle PDF files - render pages visually
        if (fileExtension === "pdf" || file.type === "application/pdf") {
          previewEmpty.classList.add("hidden");
          previewContent.classList.remove("hidden");
          pdfViewer.classList.add("hidden");
          textPreview.classList.remove("hidden");
          previewText.textContent = "Loading PDF...";
          await loadPDF(file);
        }
        // Handle text files directly
        else if (file.type === "text/plain" || fileExtension === "txt") {
          const reader = new FileReader();
          reader.onload = (e) => {
            previewText.textContent = e.target.result;
            pdfViewer.classList.add("hidden");
            textPreview.classList.remove("hidden");
            previewEmpty.classList.add("hidden");
            previewContent.classList.remove("hidden");
          };
          reader.readAsText(file);
        }
        // Handle DOCX and other files - show formatted preview
        else {
          previewText.textContent = "Loading preview...";
          pdfViewer.classList.add("hidden");
          textPreview.classList.remove("hidden");
          previewEmpty.classList.add("hidden");
          previewContent.classList.remove("hidden");

          try {
            const formData = new FormData();
            formData.append("file", file);

            const response = await fetch(`${API_BASE_URL}/api/preview`, {
              method: "POST",
              body: formData,
            });

            if (response.ok) {
              const data = await response.json();
              let previewContent = data.preview || "";
              if (data.truncated) {
                previewContent +=
                  "\n\n... (preview truncated, showing first 5000 characters)";
              }
              previewText.textContent = previewContent;
            } else {
              previewText.textContent = `Error loading preview: ${response.statusText}`;
            }
          } catch (error) {
            previewText.textContent = `Error loading preview: ${error.message}`;
          }
        }
      }

      removeFileBtn.addEventListener("click", () => {
        currentFile = null;
        fileInput.value = "";
        uploadedFileSection.classList.add("hidden");
        dropZone.classList.remove("hidden");
        previewEmpty.classList.remove("hidden");
        previewContent.classList.add("hidden");
        pdfViewer.classList.add("hidden");
        textPreview.classList.add("hidden");
        pdfDoc = null;
        currentPageNum = 1;
      });

      // Action select handler
      actionSelect.addEventListener("change", (e) => {
        if (e.target.value === "compare") {
          secondFileSection.classList.remove("hidden");
        } else {
          secondFileSection.classList.add("hidden");
          currentFile2 = null;
          fileInput2.value = "";
        }
      });

      // Process button
      processBtn.addEventListener("click", async () => {
        if (!currentFile) {
          alert("Please upload a file first");
          return;
        }

        const action = actionSelect.value;

        if (action === "compare" && !currentFile2) {
          alert("Please upload a second file for comparison");
          return;
        }

        // Show loading
        initialState.classList.add("hidden");
        resultState.classList.add("hidden");
        loadingState.classList.remove("hidden");
        processBtn.disabled = true;

        try {
          const formData = new FormData();
          formData.append("file", currentFile);

          let endpoint = "";
          switch (action) {
            case "summarize":
              endpoint = "/api/summarize";
              break;
            case "extract":
              endpoint = "/api/extract";
              formData.append("extraction_type", "all");
              break;
            case "classify":
              endpoint = "/api/classify";
              break;
            case "convert-json":
              endpoint = "/api/convert-json";
              break;
            case "compare":
              endpoint = "/api/compare";
              formData.append("file2", currentFile2);
              break;
          }

          const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            throw new Error(`Error: ${response.statusText}`);
          }

          const data = await response.json();
          displayResults(data, action);
        } catch (error) {
          resultContent.innerHTML = `<div class="text-red-500"><p>Error: ${error.message}</p></div>`;
          loadingState.classList.add("hidden");
          resultState.classList.remove("hidden");
        } finally {
          processBtn.disabled = false;
        }
      });

      function displayResults(data, action) {
        loadingState.classList.add("hidden");
        initialState.classList.add("hidden");
        resultState.classList.remove("hidden");

        let html = "";

        switch (action) {
          case "summarize":
            html = `
                <h4 class="text-sm font-bold text-primary uppercase tracking-wider mb-4">Generated Summary</h4>
                <p class="text-sm leading-relaxed text-gray-600 dark:text-gray-300 whitespace-pre-wrap">${
                  data.summary
                }</p>
                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <p class="text-xs text-gray-500">Word count: ${
                      data.word_count || "N/A"
                    }</p>
                </div>
            `;
            break;
          case "extract":
            html = `
                <h4 class="text-sm font-bold text-primary uppercase tracking-wider mb-4">Extracted Information</h4>
                <div class="space-y-4">
                    ${Object.entries(data.extracted || {})
                      .map(
                        ([key, values]) => `
                        <div>
                            <h5 class="text-xs font-semibold text-gray-700 dark:text-gray-300 uppercase mb-2">${key}</h5>
                            <ul class="list-disc list-inside text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                ${
                                  Array.isArray(values)
                                    ? values
                                        .map((v) => `<li>${v}</li>`)
                                        .join("")
                                    : `<li>${values}</li>`
                                }
                            </ul>
                        </div>
                    `
                      )
                      .join("")}
                </div>
            `;
            break;
          case "classify":
            html = `
                <h4 class="text-sm font-bold text-primary uppercase tracking-wider mb-4">Document Classification</h4>
                <div class="space-y-3">
                    <div>
                        <span class="text-xs font-semibold text-gray-500 dark:text-gray-400">Category:</span>
                        <span class="ml-2 text-sm font-bold text-gray-800 dark:text-gray-200 capitalize">${(
                          data.category || ""
                        ).replace(/_/g, " ")}</span>
                    </div>
                    <div>
                        <span class="text-xs font-semibold text-gray-500 dark:text-gray-400">Confidence:</span>
                        <span class="ml-2 text-sm text-gray-800 dark:text-gray-200 capitalize">${
                          data.confidence
                        }</span>
                    </div>
                    <div class="pt-2 border-t border-gray-200 dark:border-gray-700">
                        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Key Indicators:</p>
                        <p class="text-sm text-gray-600 dark:text-gray-300">${
                          data.indicators || "N/A"
                        }</p>
                    </div>
                </div>
            `;
            break;
          case "convert-json":
            html = `
                <h4 class="text-sm font-bold text-primary uppercase tracking-wider mb-4">JSON Conversion</h4>
                <pre class="text-xs bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-auto text-gray-700 dark:text-gray-300">${
                  data.json_string || JSON.stringify(data.json, null, 2)
                }</pre>
                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <p class="text-xs text-gray-500">Fields: ${
                      data.fields_count || "N/A"
                    } | Retries: ${data.retries_used || "N/A"}</p>
                </div>
            `;
            break;
          case "compare":
            html = `
                <h4 class="text-sm font-bold text-primary uppercase tracking-wider mb-4">Document Comparison</h4>
                <div class="space-y-4">
                    <div>
                        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2">Similarity Score:</p>
                        <p class="text-2xl font-bold text-primary">${(
                          data.similarity_score * 100
                        ).toFixed(1)}%</p>
                    </div>
                    <div>
                        <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2">Overall Summary:</p>
                        <p class="text-sm text-gray-600 dark:text-gray-300">${
                          data.overall_summary || "N/A"
                        }</p>
                    </div>
                    ${
                      data.additions && data.additions.length > 0
                        ? `
                        <div>
                            <p class="text-xs font-semibold text-red-600 dark:text-red-400 mb-2">Additions (${
                              data.additions.length
                            }):</p>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                ${data.additions
                                  .slice(0, 5)
                                  .map(
                                    (a) =>
                                      `<li>${a.content.substring(
                                        0,
                                        100
                                      )}...</li>`
                                  )
                                  .join("")}
                            </ul>
                        </div>
                    `
                        : ""
                    }
                    ${
                      data.deletions && data.deletions.length > 0
                        ? `
                        <div>
                            <p class="text-xs font-semibold text-red-600 dark:text-red-400 mb-2">Deletions (${
                              data.deletions.length
                            }):</p>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                ${data.deletions
                                  .slice(0, 5)
                                  .map(
                                    (d) =>
                                      `<li>${d.content.substring(
                                        0,
                                        100
                                      )}...</li>`
                                  )
                                  .join("")}
                            </ul>
                        </div>
                    `
                        : ""
                    }
                    ${
                      data.modifications && data.modifications.length > 0
                        ? `
                        <div>
                            <p class="text-xs font-semibold text-yellow-600 dark:text-yellow-400 mb-2">Modifications (${
                              data.modifications.length
                            }):</p>
                            <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                ${data.modifications
                                  .slice(0, 5)
                                  .map(
                                    (m) =>
                                      `<li>${m.summary.substring(
                                        0,
                                        100
                                      )}...</li>`
                                  )
                                  .join("")}
                            </ul>
                        </div>
                    `
                        : ""
                    }
                </div>
            `;
            break;
        }

        resultContent.innerHTML = html;
        // Store current result data for copy/download
        currentResultData = data;
        currentResultAction = action;
      }

      // Clear button
      clearBtn.addEventListener("click", () => {
        currentFile = null;
        currentFile2 = null;
        fileInput.value = "";
        fileInput2.value = "";
        uploadedFileSection.classList.add("hidden");
        dropZone.classList.remove("hidden");
        secondFileSection.classList.add("hidden");
        previewEmpty.classList.remove("hidden");
        previewContent.classList.add("hidden");
        pdfViewer.classList.add("hidden");
        textPreview.classList.add("hidden");
        initialState.classList.remove("hidden");
        resultState.classList.add("hidden");
        loadingState.classList.add("hidden");
        pdfDoc = null;
        currentPageNum = 1;
        currentResultData = null;
        currentResultAction = null;
      });

      // Copy button functionality
      copyResultBtn.addEventListener("click", async () => {
        if (!resultContent || !resultContent.textContent) {
          alert("No results to copy");
          return;
        }

        try {
          // Copy formatted text content to clipboard
          const textToCopy =
            resultContent.innerText || resultContent.textContent;
          await navigator.clipboard.writeText(textToCopy);

          // Visual feedback
          const originalHTML = copyResultBtn.innerHTML;
          copyResultBtn.innerHTML =
            '<span class="material-symbols-outlined">check</span>';
          copyResultBtn.classList.add("text-green-500");
          setTimeout(() => {
            copyResultBtn.innerHTML = originalHTML;
            copyResultBtn.classList.remove("text-green-500");
          }, 2000);
        } catch (error) {
          console.error("Failed to copy:", error);
          alert("Failed to copy to clipboard. Please try again.");
        }
      });

      // Download button functionality - Generate Word document
      downloadResultBtn.addEventListener("click", async () => {
        if (!currentResultData || !currentResultAction) {
          alert("No results to download");
          return;
        }

        try {
          await generateWordDocument(currentResultData, currentResultAction);

          // Visual feedback
          const originalHTML = downloadResultBtn.innerHTML;
          downloadResultBtn.innerHTML =
            '<span class="material-symbols-outlined">check</span>';
          downloadResultBtn.classList.add("text-green-500");
          setTimeout(() => {
            downloadResultBtn.innerHTML = originalHTML;
            downloadResultBtn.classList.remove("text-green-500");
          }, 2000);
        } catch (error) {
          console.error("Failed to download:", error);
          alert("Failed to generate Word document. Please try again.");
        }
      });

      // Function to generate Word document
      async function generateWordDocument(data, action) {
        // Check if docx library is available, otherwise use HTML fallback
        if (
          typeof docx === "undefined" ||
          typeof docx.Document === "undefined"
        ) {
          generateHTMLWordDocument(data, action);
          return;
        }

        try {
          // Create document content based on action type
          let docContent = [];

          // Title
          docContent.push({
            text: `DocSense AI Processed Results - ${
              action.charAt(0).toUpperCase() + action.slice(1)
            }`,
            heading: docx.HeadingLevel.HEADING_1,
            spacing: { after: 200 },
          });

          // Add date
          docContent.push({
            text: `Generated on: ${new Date().toLocaleString()}`,
            italics: true,
            color: "666666",
            spacing: { after: 400 },
          });

          // Content based on action type
          switch (action) {
            case "summarize":
              docContent.push({
                text: "Summary",
                heading: docx.HeadingLevel.HEADING_2,
                spacing: { before: 200, after: 200 },
              });
              docContent.push({
                text: data.summary || "No summary available",
                spacing: { after: 400 },
              });
              if (data.word_count) {
                docContent.push({
                  text: `Word Count: ${data.word_count}`,
                  italics: true,
                  color: "666666",
                });
              }
              break;

            case "extract":
              docContent.push({
                text: "Extracted Information",
                heading: docx.HeadingLevel.HEADING_2,
                spacing: { before: 200, after: 200 },
              });
              if (data.extracted) {
                for (const [key, values] of Object.entries(data.extracted)) {
                  docContent.push({
                    text: key.charAt(0).toUpperCase() + key.slice(1),
                    heading: docx.HeadingLevel.HEADING_3,
                    spacing: { before: 150, after: 100 },
                  });
                  const valueList = Array.isArray(values) ? values : [values];
                  valueList.forEach((value) => {
                    docContent.push({
                      text: `â€¢ ${value}`,
                      spacing: { after: 50 },
                    });
                  });
                }
              }
              break;

            case "classify":
              docContent.push({
                text: "Document Classification",
                heading: docx.HeadingLevel.HEADING_2,
                spacing: { before: 200, after: 200 },
              });
              docContent.push({
                text: `Category: ${data.category || "N/A"}`,
                spacing: { after: 100 },
              });
              docContent.push({
                text: `Confidence: ${data.confidence || "N/A"}`,
                spacing: { after: 200 },
              });
              if (data.indicators) {
                docContent.push({
                  text: "Key Indicators",
                  heading: docx.HeadingLevel.HEADING_3,
                  spacing: { before: 150, after: 100 },
                });
                docContent.push({
                  text: data.indicators,
                });
              }
              break;

            case "convert-json":
              docContent.push({
                text: "JSON Conversion",
                heading: docx.HeadingLevel.HEADING_2,
                spacing: { before: 200, after: 200 },
              });
              docContent.push({
                text: JSON.stringify(data.json || data, null, 2),
                font: "Courier New",
                spacing: { after: 400 },
              });
              if (data.fields_count) {
                docContent.push({
                  text: `Fields: ${data.fields_count} | Retries: ${
                    data.retries_used || 0
                  }`,
                  italics: true,
                  color: "666666",
                });
              }
              break;

            case "compare":
              docContent.push({
                text: "Document Comparison",
                heading: docx.HeadingLevel.HEADING_2,
                spacing: { before: 200, after: 200 },
              });
              docContent.push({
                text: `Similarity Score: ${(
                  (data.similarity_score || 0) * 100
                ).toFixed(1)}%`,
                spacing: { after: 200 },
              });
              if (data.overall_summary) {
                docContent.push({
                  text: "Overall Summary",
                  heading: docx.HeadingLevel.HEADING_3,
                  spacing: { before: 150, after: 100 },
                });
                docContent.push({
                  text: data.overall_summary,
                  spacing: { after: 200 },
                });
              }

              if (data.additions && data.additions.length > 0) {
                docContent.push({
                  text: `Additions (${data.additions.length})`,
                  heading: docx.HeadingLevel.HEADING_3,
                  color: "006600",
                  spacing: { before: 150, after: 100 },
                });
                data.additions.slice(0, 10).forEach((add) => {
                  docContent.push({
                    text: `â€¢ ${add.content || add}`,
                    spacing: { after: 50 },
                  });
                });
              }

              if (data.deletions && data.deletions.length > 0) {
                docContent.push({
                  text: `Deletions (${data.deletions.length})`,
                  heading: docx.HeadingLevel.HEADING_3,
                  color: "CC0000",
                  spacing: { before: 150, after: 100 },
                });
                data.deletions.slice(0, 10).forEach((del) => {
                  docContent.push({
                    text: `â€¢ ${del.content || del}`,
                    spacing: { after: 50 },
                  });
                });
              }

              if (data.modifications && data.modifications.length > 0) {
                docContent.push({
                  text: `Modifications (${data.modifications.length})`,
                  heading: docx.HeadingLevel.HEADING_3,
                  color: "CC6600",
                  spacing: { before: 150, after: 100 },
                });
                data.modifications.slice(0, 10).forEach((mod) => {
                  docContent.push({
                    text: `â€¢ ${mod.summary || mod}`,
                    spacing: { after: 50 },
                  });
                });
              }
              break;
          }

          // Create document
          const doc = new docx.Document({
            sections: [
              {
                properties: {},
                children: docContent,
              },
            ],
          });

          // Generate and download
          const blob = await docx.Packer.toBlob(doc);
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          const fileName =
            "docsense-" + action + "-" + new Date().getTime() + ".docx";
          a.download = fileName;
          a.click();
          URL.revokeObjectURL(url);
        } catch (error) {
          console.error("Error generating Word document:", error);
          // Fallback to HTML format that Word can open
          generateHTMLWordDocument(data, action);
        }
      }

      // Fallback function to generate HTML-based Word document
      function generateHTMLWordDocument(data, action) {
        function escapeHtml(text) {
          if (!text) return "";
          const div = document.createElement("div");
          div.textContent = text;
          return div.innerHTML;
        }

        const actionTitle = action.charAt(0).toUpperCase() + action.slice(1);
        const generatedDate = new Date().toLocaleString();
        const styleEnd = "<" + "/style>";
        const headEnd = "<" + "/head>";
        const bodyStart = "<body>";
        const bodyEnd = "<" + "/body>";
        const htmlEnd = "<" + "/html>";

        let html = "<!DOCTYPE html><html><head>";
        html += '<meta charset="UTF-8">';
        html += "<title>DocSense Results - " + escapeHtml(action) + "</title>";
        html += "<style>";
        html +=
          "body { font-family: Calibri, Arial, sans-serif; margin: 40px; line-height: 1.6; }";
        html +=
          "h1 { color: #137fec; border-bottom: 2px solid #137fec; padding-bottom: 10px; }";
        html += "h2 { color: #333; margin-top: 30px; }";
        html += "h3 { color: #666; margin-top: 20px; }";
        html +=
          ".metadata { color: #666; font-style: italic; margin-bottom: 30px; }";
        html += "ul { margin-left: 20px; }";
        html +=
          "pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }";
        html += styleEnd + headEnd + bodyStart;
        html +=
          "<h1>DocSense AI Processed Results - " +
          escapeHtml(actionTitle) +
          "</h1>";
        html +=
          '<p class="metadata">Generated on: ' +
          escapeHtml(generatedDate) +
          "</p>";

        // Add content based on action (simplified HTML version)
        if (action === "summarize") {
          const summary = escapeHtml(
            data.summary || "No summary available"
          ).replace(/\n/g, "<br>");
          html += "<h2>Summary</h2><p>" + summary + "</p>";
          if (data.word_count)
            html +=
              "<p><em>Word Count: " +
              escapeHtml(String(data.word_count)) +
              "</em></p>";
        } else if (action === "extract") {
          html += "<h2>Extracted Information</h2>";
          if (data.extracted) {
            for (const [key, values] of Object.entries(data.extracted)) {
              html +=
                "<h3>" +
                escapeHtml(key.charAt(0).toUpperCase() + key.slice(1)) +
                "</h3><ul>";
              const valueList = Array.isArray(values) ? values : [values];
              valueList.forEach(
                (v) => (html += "<li>" + escapeHtml(String(v)) + "</li>")
              );
              html += "</ul>";
            }
          }
        } else if (action === "classify") {
          html += "<h2>Document Classification</h2>";
          html +=
            "<p><strong>Category:</strong> " +
            escapeHtml(String(data.category || "N/A")) +
            "</p>";
          html +=
            "<p><strong>Confidence:</strong> " +
            escapeHtml(String(data.confidence || "N/A")) +
            "</p>";
          if (data.indicators)
            html +=
              "<h3>Key Indicators</h3><p>" +
              escapeHtml(String(data.indicators)) +
              "</p>";
        } else if (action === "convert-json") {
          html +=
            "<h2>JSON Conversion</h2><pre>" +
            escapeHtml(JSON.stringify(data.json || data, null, 2)) +
            "</pre>";
        } else if (action === "compare") {
          html += "<h2>Document Comparison</h2>";
          html +=
            "<p><strong>Similarity Score:</strong> " +
            ((data.similarity_score || 0) * 100).toFixed(1) +
            "%</p>";
          if (data.overall_summary)
            html +=
              "<h3>Overall Summary</h3><p>" +
              escapeHtml(String(data.overall_summary)) +
              "</p>";
          // Add additions, deletions, modifications if present
          if (data.additions && data.additions.length > 0) {
            html +=
              '<h3 style="color: #006600;">Additions (' +
              data.additions.length +
              ")</h3><ul>";
            data.additions.slice(0, 10).forEach((a) => {
              html += "<li>" + escapeHtml(String(a.content || a)) + "</li>";
            });
            html += "</ul>";
          }
          if (data.deletions && data.deletions.length > 0) {
            html +=
              '<h3 style="color: #CC0000;">Deletions (' +
              data.deletions.length +
              ")</h3><ul>";
            data.deletions.slice(0, 10).forEach((d) => {
              html += "<li>" + escapeHtml(String(d.content || d)) + "</li>";
            });
            html += "</ul>";
          }
          if (data.modifications && data.modifications.length > 0) {
            html +=
              '<h3 style="color: #CC6600;">Modifications (' +
              data.modifications.length +
              ")</h3><ul>";
            data.modifications.slice(0, 10).forEach((m) => {
              html += "<li>" + escapeHtml(String(m.summary || m)) + "</li>";
            });
            html += "</ul>";
          }
        }

        html += bodyEnd + htmlEnd;

        // Download as .doc file (HTML format that Word can open)
        const blob = new Blob([html], { type: "application/msword" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        const fileName =
          "docsense-" + action + "-" + new Date().getTime() + ".doc";
        a.download = fileName;
        a.click();
        URL.revokeObjectURL(url);
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return (
          Math.round((bytes / Math.pow(k, i)) * 100) / 100 + " " + sizes[i]
        );
      }
    </script>
  </body>
</html>
